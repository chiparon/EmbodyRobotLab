% ============================================================
% 实验5.2 基于 MATLAB Robotics Toolbox 的正逆运动学分析
% 参考手册 Page29–31
% CHIPARON,10/30/2025
% ============================================================

clear; clc; close all;

%% 1. 调用自带模型
mdl_puma560;           % 加载PUMA560模型与关节向量qz, qr, qs, qn
p560 = SerialLink(p560);

%% 2. 设置两组关节变量姿态
q1 = [0, -pi/6, -pi/4, 0, pi/6, 0];      % 第一组姿态
q2 = [pi/4, pi/6, -pi/3, 0, pi/8, pi/4]; % 第二组姿态

%% 3. 正运动学分析
T1 = p560.fkine(q1);   % 末端位姿1
T2 = p560.fkine(q2);   % 末端位姿2

disp('---------------------------------------------');
disp('第一组 q1 的末端执行器齐次变换矩阵 T1 = ');
disp(T1);

disp('---------------------------------------------');
disp('第二组 q2 的末端执行器齐次变换矩阵 T2 = ');
disp(T2);

%% 4. 逆运动学分析
qi1 = p560.ikine(T1);  % 从T1求关节角
qi2 = p560.ikine(T2);  % 从T2求关节角

disp('---------------------------------------------');
disp('由 T1 反解得到的关节角 qi1 = ');
disp(qi1);

disp('---------------------------------------------');
disp('由 T2 反解得到的关节角 qi2 = ');
disp(qi2);

%% 5. 验证正逆解是否一致
disp('q1 与 qi1 误差 = ');
disp(q1 - qi1);

disp('q2 与 qi2 误差 = ');
disp(q2 - qi2);

%% 6. 图形展示两种姿态
figure('Name','PUMA560 正逆运动学仿真'); 
subplot(1,2,1);
p560.plot(q1);
title('PUMA560 - 姿态 q1');
subplot(1,2,2);
p560.plot(q2);
title('PUMA560 - 姿态 q2');

